const mysql = require('mysql');

class ClassCrud{

    constructor(){
        
        this.sql = mysql.createConnection({

            host:'localhost',
            user:'root',
            password:'',
            database:'nodejs',
            port:3308,
        
        });
        //this.sql.query("use nodejs");

    }

    read(req,res){
        if(!req.params.id){
            this.sql.query("select * from animal order by id asc",function(err,results,fileds){
                res.render('select',{data:results});
            });
        }
        else{
            this.sql.query("select * from animal where id=? order by id asc",[req.params.id],function(err,results,fileds){
                res.render('select',{data:results});
            });
        }  
    }

    create(req,res){
        this.sql.query("insert into animal values(0,?,?,?,?,?,?,?,?,?)",[req.body.name,req.body.proprietario,
            req.body.especie,req.body.raca,req.body.pelagem,req.body.sexo,req.body.peso,
                req.body.idade,req.body.nascimento]);
            res.render('controllerForm');
    }

    update(req,res,controller=null){
        if(controller==null){
            this.sql.query("select * from animal where id=?",[req.params.id],function(err,results,fields){
       
                res.render('update',{id:req.params.id, name:results[0].name,proprietario:results[0].proprietario,
                    especie:results[0].especie,raca:results[0].raca,pelagem:results[0].pelagem,sexo:results[0].sexo,
                    peso:results[0].peso,idade:results[0].idade,nascimento:results[0].nascimento});
            
                });
        }
        else{
            this.sql.query("update animal set name=?, proprietario=?,especie=?,raca=?,pelagem=?,sexo=?,peso=?,idade=?,nascimento=? where id=?",
             [req.body.name,req.body.proprietario,
                req.body.especie,req.body.raca,req.body.pelagem,req.body.sexo,req.body.peso,
                req.body.idade,req.body.nascimento,req.body.id]);

            res.render('controllerUpdate');
        }
    }

    deletes(req,res){
        this.sql.query("delete from animal where id=?",[req.params.id]);
        res.render('deletar');
    }

}

module.exports = ClassCrud;